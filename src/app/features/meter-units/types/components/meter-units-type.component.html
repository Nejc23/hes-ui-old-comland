<app-auto-refresh
      (timerExpired)="refresh()"
      [elapseTime]="refreshInterval"
      [hidden]="true">
</app-auto-refresh>

<div class="row">
  <div class="col-2" *ngIf="!hideFilter">
    <app-meter-unit-filter (filterChange)="reloadGrid()"></app-meter-unit-filter>
  </div>
  <div [ngClass]="{'col-10': !hideFilter, 'col-12': hideFilter}">
    <a [ngbTooltip]="hidwShowFilters" href="javascript:void(0);" style="position:absolute; top:-20px" (click)="clickShowHideFilter()">
        <i class="fa fa-arrow-right" [ngClass]="{'far fa-arrow-left': !hideFilter, 'far fa-arrow-right': hideFilter}" ></i>
    </a>

<!-- row total items, selected filter name -->
<div *ngIf="!noData">

  <div class="d-flex justify-content-between mb-2">
    <div class="d-flex align-items-center p-2 grid-actions">
      <div class="mr-3" *ngIf="!selectedAtLeastOneRowOnGrid">
        <small class="text-secondary">
          {{totalCount}} <span i18n>items</span> &middot; {{filters}}
          <a class="ml-3" *ngIf="isFilterSet()" href="javascript:void(0);" (click)="clearFilter()"><span i18n>Clear all</span></a>
        </small>
      </div>
      <div class="mr-3" *ngIf="!checkSelectedAll() && selectedAtLeastOneRowOnGrid">
        <small class="link">{{gridApi.getSelectedRows().length}} <strong><span i18n>items selected</span> &middot;
          <a class="text-primary" href="javascript:void(0);" (click)="selectAll()"><span i18n>Select all</span>
                ({{totalCount}})</a></strong></small>
      </div>
      <div class="mr-3" *ngIf="checkSelectedAll() && selectedAtLeastOneRowOnGrid">
        <small class="link"><strong><span i18n>All ({{getTotalCountWithoutExcludedDisplay()}}) items selected</span> &middot;
          <a class="text-primary" href="javascript:void(0);" (click)="deselectAll()"><span i18n>Clear
                  selected</span></a></strong></small>
      </div>
      <div *ngIf="selectedAtLeastOneRowOnGrid">

        <div class="btn-group">
          <button class="btn btn-primary dropdown-toggle" type="button" id="operationsDropDown" data-toggle="dropdown"><span i18n>Operations</span></button>
          <div class="dropdown-menu">

            <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Delete</span></button>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUReadJobs" class="dropdown-item" type="button"
                (click)="onScheduleReadJobs()"><span i18n>Jobs</span>
            </button>

            <div class="dropdown-divider"></div>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUUpgrade" class="dropdown-item" type="button"
                (click)="onUpgrade()"><span i18n>Upload image</span>
            </button>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUUpgrade" class="dropdown-item" type="button"
                (click)="onActivateUpgrade()"><span i18n>Activate image</span>
            </button>

            <div class="dropdown-divider"></div>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUConnect" class="dropdown-item" type="button"
                (click)="onConnect()"><span i18n>Connect</span>
            </button>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUDisconnect" class="dropdown-item" type="button"
                (click)="onDisconnect()"><span i18n>Disconnect</span>
            </button>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUBreakerStatus" class="dropdown-item" type="button"
                (click)="onBreakerStatus()"><span i18n>State</span>
            </button>

            <div class="dropdown-divider"></div>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUTOU" class="dropdown-item" type="button"
                (click)="onTou()"><span i18n>TOU Upload</span>
            </button>

            <div class="dropdown-divider"></div>

            <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUSetLimiter" class="dropdown-item" type="button"
                (click)="onSetLimiter()"><span i18n>Limiter</span>
            </button>

            <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Display</span></button>
            <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Monitor</span></button>
            <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Clear FF</span></button>
            <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Clear Alarms</span></button>
          </div>
        </div>

        <button [appHideIfAuthorizedReadonly]="formFunctionality" type="button" class="btn btn-primary" [disabled]="true"><i class="far fa-tags"></i><span i18n>Tags</span></button>
        <button [appHideIfAuthorizedReadonly]="formFunctionality" type="button" class="btn btn-primary" [disabled]="true"><i class="fa far-line-chart" disabled></i><span i18n>Data</span></button>

      </div>
    </div>

    <div class="p-2 d-flex align-items-center p-2 grid-actions">
      <app-action-form (searchChange)=searchData($event) (refresh)="refreshGrid()" class="ml-auto justify-content-end" [gridColumns]="columns"></app-action-form>
    </div>
  </div>


<!--

  <div class="d-flex align-items-center p-2 bg-white grid-actions" *ngIf="!selectedAtLeastOneRowOnGrid">
    <small class="text-secondary">
      {{totalCount}} <span i18n>items</span> &middot; {{filters}}
      <a class="ml-3" *ngIf="isFilterSet()" href="javascript:void(0);" (click)="clearFilter()"><span i18n>Clear all</span></a>
    </small>
    <app-action-form (searchChange)=searchData($event) (refresh)="refreshGrid()" class="ml-auto justify-content-end"></app-action-form>
  </div>

  <div class="d-flex align-items-center p-2 bg-primary" *ngIf="selectedAtLeastOneRowOnGrid">
    <div class="mr-3" *ngIf="!checkSelectedAll()">
      <small class="text-white">{{gridApi.getSelectedRows().length}} <span i18n>items selected</span>  &middot;
      <strong><u><a class="text-white" href="javascript:void(0);" (click)="selectAll()"><span i18n>Select all</span> ({{totalCount}})</a></u></strong></small>
    </div>
    <div class="mr-3" *ngIf="checkSelectedAll()">
      <small class="text-white"><span i18n>All ({{getTotalCountWithoutExcluded()}}) items selected</span> &middot;
      <strong><u><a class="text-white" href="javascript:void(0);" (click)="deselectAll()"><span i18n>Clear selected</span></a></u></strong></small>
    </div>
    -->
    <!-- <button [appHideIfAuthorizedReadonly]="formFunctionality" type="button" class="btn btn-link" (click)="onDelete()"><i class="far fa-trash"></i></button>
    <button [appHideIfAuthorizedReadonly]="formFunctionality" type="button" class="btn btn-link" (click)="onTag()"><i class="far fa-tags"></i></button> -->

    <!-- <div class="btn-group dropdown" appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUReadJobs">
      <button  type="button" class="btn btn-link"
        (click)="onScheduleReadJobs()"><i class="far fa-calendar"></i><span i18n>Read Jobs</span></button>
      <button type="button" class="btn btn-link dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"
        aria-haspopup="true" aria-expanded="false" [ngbTooltip]="tipMoreSave">
      </button>
      <div class="dropdown-menu dropdown-menu-right">
        <a class="dropdown-item" (click)="onScheduleReadJobs()" i18n>Assign jobs</a>
        <a class="dropdown-item" (click)="onScheduleReadJobs()" i18n>De-assign jobs</a>
      </div>
    </div> -->
  <!--
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUReadJobs" type="button" class="btn btn-link"
    (click)="onScheduleReadJobs()"><i class="far fa-calendar"></i><span i18n>Read Jobs</span></button>

    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUBreakerStatus" type="button" class="btn btn-link"
            (click)="onBreakerStatus()"><i class="far fa-list-alt"></i><span i18n>Breaker Status</span></button>
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUConnect" type="button" class="btn btn-link"
            (click)="onConnect()"><i class="far fa-plug"></i><span i18n>Connect</span></button>
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUDisconnect" type="button" class="btn btn-link"
            (click)="onDisconnect()"><i class="far fa-plug"></i><span i18n>Disconnect</span></button>
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUSetLimiter" type="button" class="btn btn-link"
            (click)="onSetLimiter()"><i class="far fa-info-circle"></i><span i18n>Set Limiter</span></button>
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUTOU" type="button" class="btn btn-link"
            (click)="onTou()"><i class="far fa-cog"></i><span i18n>TOU</span></button>
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUUpgrade" type="button" class="btn btn-link"
            (click)="onUpgrade()"><i class="far fa-arrow-alt-square-up"></i><span i18n>Upgrade</span></button>
    <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUUpgrade" type="button" class="btn btn-link"
            (click)="onActivateUpgrade()"><i class="far fa-level-up"></i><span i18n>Activate upgrade</span></button>
  </div>
  -->
  <!-- ag-grid -->
  <ag-grid-angular
    class="ag-theme-epoint"
    style="width: 100%; height: calc(100% - 25px);"
    #agGrid

    [domLayout]=agGridSettings.domLayout
    suppressSizeToFit=agGridSettings.suppressSizeToFit
    [localeText]="localeText"

    [modules]="modules"
    [icons]="icons"
    [pagination]=agGridSettings.pagination

    [paginationPageSize]=agGridSettings.paginationPageSize
    [multiSortKey]=agGridSettings.multiSortKey
    [cacheOverflowSize]="agGridSettings.cacheOverflowSize"
    [maxConcurrentDatasourceRequests]="agGridSettings.maxConcurrentDatasourceRequests"
    [frameworkComponents]="frameworkComponents"
    [cacheBlockSize]=agGridSettings.paginationPageSize
    [maxBlocksInCache]="1"
    [gridOptions]="gridOptions"
    [columnDefs]="columns"

    [suppressRowClickSelection]=agGridSettings.suppressRowClickSelection
    [rowSelection]=agGridSettings.rowSelection
    [sideBar]="sideBar"

    [overlayNoRowsTemplate]="overlayNoRowsTemplate"
    [overlayLoadingTemplate]="overlayLoadingTemplate"
    (selectionChanged)="onSelectionChanged()"
    (gridReady)="onGridReady($event)"
    (columnVisible)="onColumnVisible($event)"
    (paginationChanged)="onPaginationChange($event)"
    (rowSelected)="onRowSelect($event)"
    (firstDataRendered)="onFirstDataRendered($event)"
    (cellMouseOver)="cellMouseOver($event)"
    (cellMouseOut)="cellMouseOut($event)"
    >
  </ag-grid-angular>
</div>
<div *ngIf="noData" class="d-flex flex-column justify-content-center align-items-center" style="height:80vh;">
  <div class="p-1"><i class="far fa-empty-set fa-3x text-secondary"></i></div>
  <div class="p-1"><h2 i18n>You have no Data Concentrator Units yet!</h2></div>
  <div class="p-1"><button type="button" class="btn btn-primary bg-primary" ><i class="far fa-plus"><span i18n> Add New</span></i></button></div>
</div>
</div>
<ng-template #tipMoreSave><span i18n>More options</span></ng-template>
<ng-template #hidwShowFilters><span i18n>Show/hide filters</span></ng-template>
