<app-auto-refresh
      (timerExpired)="refresh()"
      [elapseTime]="refreshInterval"
      [hidden]="true">
</app-auto-refresh>

<div class="row">
  <div class="col-2 filter-shadow-container" *ngIf="!hideFilter">
    <div class="filter-shadow">
      <app-meter-unit-filter (filterChange)="reloadGrid(); deselectAll();" (toggleFilter)="toggleFilter()"></app-meter-unit-filter>
    </div>
  </div>

  <div class="filter-button" [ngClass]="{'col-10': !hideFilter, 'col-12': hideFilter}">

<!-- row total items, selected filter name -->
<div *ngIf="!noData">

  <div class="mb-2">
    <div class="grid-actions">
      <app-action-form
        [gridColumns]="columns"
        [isFilterOpened]="!hideFilter"
        [filtersInfo]="filtersInfo"
        (searchChange)="searchData($event)"
        (refresh)="refreshGrid()"
        (toggleFilter)="toggleFilter()">

        <div *ngIf="selectedAtLeastOneRowOnGrid" class="pr-3">
          <div dropdown class="btn-group">
            <button dropdownToggle class="btn btn-primary dropdown-toggle" type="button" id="operationsDropDown" data-toggle="dropdown"><span i18n>Operations</span></button>
            <div *dropdownMenu class="dropdown-menu" style="min-width: 13rem">
              <div>
                <button class="dropdown-item" (click)="onDelete()" [disabled]="true"><span i18n>Delete</span></button>
              </div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUReadJobs" class="btn btn-link dropdown-item" type="button"
                  (click)="onScheduleReadJobs()"><span i18n>Jobs</span></button>
              </div>
              <div class="pl-3 pr-3"><hr/></div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUUpgrade" class="btn btn-link dropdown-item" type="button"
                  (click)="onUpgrade()"><span i18n>Upload image</span></button>
              </div>
              <div>
              <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUUpgrade" class="btn btn-link dropdown-item" type="button"
                  (click)="onActivateUpgrade()"><span i18n>Activate image</span></button>
              </div>
              <div class="pl-3 pr-3"><hr/></div>
              <div>
              <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUConnect" class="btn btn-link dropdown-item" type="button"
                  (click)="onConnect()"><span i18n>Connect</span></button>
              </div>
              <div>
              <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUDisconnect" class="btn btn-link dropdown-item" type="button"
                  (click)="onDisconnect()"><span i18n>Disconnect</span></button>
              </div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUBreakerStatus" class="btn btn-link dropdown-item" type="button"
                  (click)="onBreakerStatus()"><span i18n>State</span></button>
              </div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUBreakerStatus" class="btn btn-link dropdown-item" type="button"
                  (click)="onBreakerMode()"><span i18n>Mode</span></button>
              </div>
              <div class="pl-3 pr-3"><hr/></div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUCiiActivate" class="btn btn-link dropdown-item" type="button"
                    (click)="onCiiActivate()"><span i18n>CII - Activate</span></button>
              </div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUCiiDeactivate" class="btn btn-link dropdown-item" type="button"
                    (click)="onCiiDeactivate()"><span i18n>CII - Deactivate</span></button>
              </div>
              <div>
                  <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUCiiState" class="btn btn-link dropdown-item" type="button"
                    (click)="onCiiState()"><span i18n>CII - State</span></button>
              </div>
              <div class="pl-3 pr-3"><hr/></div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUTOU" class="btn btn-link dropdown-item" type="button"
                  (click)="onTou()"><span i18n>TOU Upload</span></button>
              </div>
              <div class="pl-3 pr-3"><hr/></div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUSetLimiter" class="btn btn-link dropdown-item" type="button"
                  (click)="onSetLimiter()"><span i18n>Limiter</span></button>
              </div>
              <div>
                <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Display</span></button>
              </div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUSetLimiter" class="btn btn-link dropdown-item" type="button"
                  (click)="onSetMonitor()"><span i18n>Monitor</span></button>
              </div>
              <div>
                <button appHideIfActionUnauthorized [functionality]="formFunctionality" [action]="actionMUSetLimiter"  class="btn btn-link dropdown-item" type="button"
                  (click)="onClearFF()"><span i18n>Clear FF</span></button>
              </div>
              <div>
                <button class="dropdown-item" type="button" [disabled]="true"><span i18n>Clear Alarms</span></button>
              </div>
            </div>
          </div>

          <button [appHideIfAuthorizedReadonly]="formFunctionality" type="button" class="btn btn-primary" [disabled]="true">
            <i class="far fa-tags"></i>
            <span i18n>Tags</span>
          </button>
          <button [appHideIfAuthorizedReadonly]="formFunctionality" type="button" class="btn btn-primary" [disabled]="true">
            <i class="far fa-chart-bar" disabled></i>
            <span i18n>Data</span>
          </button>
        </div>
      </app-action-form>
    </div>
  </div>

  <!-- ag-grid -->
  <ag-grid-angular
    class="ag-theme-epoint"
    style="width: 100%; height: calc(100% - 25px);"
    #agGrid

    [domLayout]=agGridSettings.domLayout
    suppressSizeToFit=agGridSettings.suppressSizeToFit
    [localeText]="localeText"

    [modules]="modules"
    [icons]="icons"
    [pagination]=agGridSettings.pagination

    [paginationPageSize]=agGridSettings.paginationPageSize
    [multiSortKey]=agGridSettings.multiSortKey
    [cacheOverflowSize]="agGridSettings.cacheOverflowSize"
    [maxConcurrentDatasourceRequests]="agGridSettings.maxConcurrentDatasourceRequests"
    [frameworkComponents]="frameworkComponents"
    [cacheBlockSize]=agGridSettings.paginationPageSize
    [maxBlocksInCache]="1"
    [gridOptions]="gridOptions"
    [columnDefs]="columns"

    [suppressRowClickSelection]=agGridSettings.suppressRowClickSelection
    [rowSelection]=agGridSettings.rowSelection
    [sideBar]="sideBar"

    [overlayNoRowsTemplate]="overlayNoRowsTemplate"
    [overlayLoadingTemplate]="overlayLoadingTemplate"
    (selectionChanged)="onSelectionChanged()"
    (gridReady)="onGridReady($event)"
    (columnVisible)="onColumnVisible($event)"
    (paginationChanged)="onPaginationChange($event)"
    (rowSelected)="onRowSelect($event)"
    (firstDataRendered)="onFirstDataRendered($event)"
    >
  </ag-grid-angular>

</div>
<div *ngIf="noData" class="d-flex flex-column justify-content-center align-items-center" style="height:80vh;">
  <div class="p-1"><i class="far fa-empty-set fa-3x text-secondary"></i></div>
  <div class="p-1"><h2 i18n>You have no Data Concentrator Units yet!</h2></div>
  <div class="p-1"><button type="button" class="btn btn-primary bg-primary" ><i class="far fa-plus">
    <span i18n> Add New</span></i>
  </button></div>
</div>
</div>
<ng-template #tipMoreSave><span i18n>More options</span></ng-template>
<ng-template #hidwShowFilters><span i18n>Show/hide filters</span></ng-template>
