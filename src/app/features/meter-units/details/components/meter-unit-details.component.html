<div class="row">
  <div class="col-4 ng-star-inserted">

    <div class="form-group" *ngIf="!editMode">
      <button class="btn btn-primary" (click)="editMeterUnit()" appHideIfPermissionUnauthorized [permission]="permissionMuManage">
        <span i18n>Edit</span>
      </button>
      <div class="btn-group pr-2" *ngIf="!editMode" appHideIfPermissionUnauthorized [permission]="permissionMuManage">
        <button class="btn btn-secondary" type="button" (click)="onDelete()"><span i18n>Delete</span></button>
      </div>
      <div dropdown class="btn-group" appHideIfAllPermissionsUnauthorized [permissions]="[
        permissionManageJobs,
        permissionManageAutoTemplates,
        permissionFwUpgrade,
        permissionFwUpgrade,
        permissionDisconnectorConnect,
        permissionDisconnectorDisconnect,
        permissionDisconnectorGetState,
        permissionDisconnectorSetMode,
        permissionCiiActivate,
        permissionCiiDeactivate,
        permissionCiiState,
        permissionRelaysConnect,
        permissionRelaysDisconnect,
        permissionRelaysState,
        permissionRelaysSetMode
      ]">
        <button dropdownToggle class="btn btn-secondary dropdown-toggle" type="button" id="operationsDropDown"
          data-toggle="dropdown"><span i18n>Operations</span></button>
        <div *dropdownMenu (click)="$event.stopPropagation();" class="dropdown-menu">
          <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionManageJobs">
            <div class="dropdown-submenu">
                <a dropdownToggle class="dropdown-toggle disabled" href="javascript:void(0)" data-toggle="dropdown"><span i18n>Job</span></a>
                <div class="dropdown-menu">
                  <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionManageJobs" (click)="onScheduleReadJobs()">
                    <a href="javascript:void(0)" ><span i18n>Create new</span></a>
                  </div>
                  <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionManageJobs" (click)="onJobsAssignExisting()">
                    <a href="javascript:void(0)" ><span i18n>Assign existing</span></a>
                  </div>
                </div>
            </div>
          </div>
          <div appHideIfPermissionUnauthorized [permission]="permissionManageAutoTemplates">
            <a href="javascript:void(0)" class="dropdown-item custom-hover-display"
            (click)="onJobsTemplates()"><span i18n>Templates</span></a>
          </div>

          <div class="dropdown-divider" appHideDividerIfPermissionsUnauthorized [permissionsAbove]="[permissionManageJobs, permissionManageAutoTemplates]" [permissionsBelow]="[permissionFwUpgrade]"></div>

          <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionFwUpgrade" >
            <div class="dropdown-submenu">
                  <a dropdownToggle class="dropdown-toggle disabled" href="javascript:void(0)" data-toggle="dropdown"><span i18n>FW upgrade</span></a>
                <div class="dropdown-menu">
                  <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionFwUpgrade" (click)="onUpgrade()">
                    <a href="javascript:void(0)" ><span i18n>Upload image</span></a>
                  </div>
                  <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionFwUpgrade" (click)="onActivateUpgrade()">
                  <a href="javascript:void(0)"><span i18n>Activate image</span></a>
                  </div>
                </div>
            </div>
          </div>

          <div class="dropdown-divider" appHideDividerIfPermissionsUnauthorized
            [permissionsAbove]="[permissionFwUpgrade]"
            [permissionsBelow]="[permissionDisconnectorConnect,
                                 permissionDisconnectorDisconnect,
                                 permissionDisconnectorGetState,
                                 permissionDisconnectorSetMode,
                                 permissionCiiActivate,
                                 permissionCiiDeactivate,
                                 permissionCiiState,
                                 permissionRelaysConnect,
                                 permissionRelaysDisconnect,
                                 permissionRelaysState,
                                 permissionRelaysSetMode]"></div>
          <div class="dropdown-item" appHideIfAllPermissionsUnauthorized [permissions]="[permissionDisconnectorConnect, permissionDisconnectorDisconnect, permissionDisconnectorGetState, permissionDisconnectorSetMode]" >
            <div class="dropdown-submenu">
              <a dropdownToggle class="dropdown-toggle disabled" href="javascript:void(0)" data-toggle="dropdown"><span i18n>Breaker</span></a>
              <div class="dropdown-menu">
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionDisconnectorConnect" (click)="onConnect()">
                  <a href="javascript:void(0)"><span i18n>Connect</span></a>
                </div>
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionDisconnectorDisconnect" (click)="onDisconnect()">
                  <a href="javascript:void(0)"><span i18n>Disconnect</span></a>
                </div>
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionDisconnectorGetState" (click)="onDisconnectorStatus()">
                  <a href="javascript:void(0)"><span i18n>State</span></a>
                </div>
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionDisconnectorSetMode" (click)="onDisconnectorMode()">
                  <a href="javascript:void(0)"><span i18n>Mode</span></a>
                </div>
              </div>
            </div>
          </div>

          <div class="dropdown-item" appHideIfAllPermissionsUnauthorized [permissions]="[permissionCiiActivate, permissionCiiDeactivate, permissionCiiState]">
            <div class="dropdown-submenu">
              <a dropdownToggle class="dropdown-toggle disabled" href="javascript:void(0)" data-toggle="dropdown"><span i18n>CII</span></a>
              <div class="dropdown-menu">
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionCiiActivate" (click)="onCiiActivate()">
                  <a href="javascript:void(0)"><span i18n>Activate</span></a>
                </div>
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionCiiDeactivate"  (click)="onCiiDeactivate()">
                  <a href="javascript:void(0)"><span i18n>Deactivate</span></a>
                </div>
                <div class="dropdown-item" appHideIfPermissionUnauthorized [permission]="permissionCiiState" (click)="onCiiState()">
                  <a href="javascript:void(0)"><span i18n>State</span></a>
                </div>
              </div>
            </div>
          </div>

          <div class="dropdown-item" appHideIfAllPermissionsUnauthorized [permissions]="[permissionRelaysConnect, permissionRelaysDisconnect, permissionRelaysState, permissionRelaysSetMode]">
            <div class="dropdown-submenu">
              <a dropdownToggle class="dropdown-toggle disabled" href="javascript:void(0)" data-toggle="dropdown"><span i18n>Relays</span></a>
            <div class="dropdown-menu">
              <div class="dropdown-item" (click)="onRelaysConnect()" appHideIfPermissionUnauthorized [permission]="permissionRelaysConnect">
                <a href="javascript:void(0)"><span i18n>Connect</span></a>
              </div>
              <div class="dropdown-item" (click)="onRelaysDisconnect()" appHideIfPermissionUnauthorized [permission]="permissionRelaysDisconnect">
                <a href="javascript:void(0)"><span i18n>Disconnect</span></a>
              </div>
              <div class="dropdown-item" (click)="onRelaysState()" appHideIfPermissionUnauthorized [permission]="permissionRelaysState">
                <a href="javascript:void(0)"><span i18n>State</span></a>
              </div>
              <div class="dropdown-item" (click)="onRelaysSetMode()" appHideIfPermissionUnauthorized [permission]="permissionRelaysSetMode">
                <a href="javascript:void(0)" ><span i18n>Mode</span></a>
              </div>
            </div>
          </div>
         </div>

         <div class="dropdown-divider" appHideDividerIfPermissionsUnauthorized
            [permissionsAbove]="[permissionDisconnectorConnect,
                                 permissionDisconnectorDisconnect,
                                 permissionDisconnectorGetState,
                                 permissionDisconnectorSetMode,
                                 permissionCiiActivate,
                                 permissionCiiDeactivate,
                                 permissionCiiState,
                                 permissionRelaysConnect,
                                 permissionRelaysDisconnect,
                                 permissionRelaysState,
                                 permissionRelaysSetMode]"
            [permissionsBelow]="[permissionTouUpload]"></div>

          <div appHideIfPermissionUnauthorized [permission]="permissionTouUpload" href="javascript:void(0)">
            <a class="dropdown-item custom-hover-display"
              (click)="onTou()"><span i18n>TOU Upload</span></a>
          </div>
          <div class="dropdown-divider" appHideDividerIfPermissionsUnauthorized
            [permissionsAbove]="[permissionTouUpload]"
            [permissionsBelow]="[permissionSetLimiter,
                                permissionSetMonitor,
                                permissionClearFF,
                                permissionSetDisplay,
                                permissionClearAlarms]"></div>
          <div appHideIfPermissionUnauthorized [permission]="permissionSetLimiter">
            <a href="javascript:void(0)" class="dropdown-item custom-hover-display"
              (click)="onSetLimiter()"><span i18n>Limiter</span></a>
          </div>
          <div appHideIfPermissionUnauthorized [permission]="permissionSetMonitor">
            <a href="javascript:void(0)" class="dropdown-item custom-hover-display"
              (click)="onSetMonitor()"><span i18n>Monitor</span></a>
          </div>
          <div appHideIfPermissionUnauthorized [permission]="permissionClearFF">
            <a href="javascript:void(0)" class="dropdown-item custom-hover-display"
              (click)="onClearFF()"><span i18n>Clear FF</span></a>
          </div>
          <div appHideIfPermissionUnauthorized [permission]="permissionSetDisplay">
            <a href="javascript:void(0)" class="dropdown-item custom-hover-display"
              (click)="onSetDisplaySettings()"><span i18n>Set display settings</span></a>
          </div>
          <div appHideIfPermissionUnauthorized [permission]="permissionClearAlarms">
            <a href="javascript:void(0)" class="dropdown-item custom-hover-display"
              (click)="onClearAlarms()"><span i18n>Clear Alarms</span></a>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group" *ngIf="editMode">
      <button type="button" class="btn btn-light" (click)="cancel()" i18n>Cancel</button>
      <button class="btn btn-primary" (click)="saveMeterUnit()" i18n>Save</button>
    </div>

    <div class="form-group" *ngIf="data">
      <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="saveError">
        <strong><span i18n>Error saving Meter Unit!</span></strong> <br /> {{saveError}}
      </div>

      <div class="form-group">
        <div class="form-row mb-4">
          <div class="col" *ngIf="!editMode">
            <div><label i18n>Name</label></div>
            <div><span>{{form.get(nameProperty).value}}</span></div>
          </div>
          <div class="col" *ngIf="editMode">
            <app-input-text [form]="form" [property]="nameProperty" i18n-label label="Name">
            </app-input-text>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col" *ngIf="!editMode">
            <div><label i18n>Serial number</label></div>
            <div><span>{{form.get(idProperty).value}}</span></div>
          </div>
          <div class="col" *ngIf="editMode">
            <app-input-text [form]="form" [property]="idProperty" i18n-label label="Serial number">
            </app-input-text>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col">
            <div><label i18n>Mac</label></div>
            <div><span>{{form.get(macProperty).value}}</span></div>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col">
            <div><label i18n>Systitle</label></div>
            <div><span>{{form.get(systitleProperty).value}}</span></div>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col">
            <div><label i18n>State</label></div>
            <div><span>{{form.get(statusProperty).value}}</span></div>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col">
            <div><label i18n>Type</label></div>
            <div><span>{{form.get(typeProperty).value}}</span></div>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col">
            <div><label i18n>Manufacturer</label></div>
            <div><span>{{form.get(vendorProperty).value}}</span></div>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col">
            <div><label i18n>Template</label></div>
            <div><span>{{form.get(templateProperty).value}}</span></div>
          </div>
        </div>
        <div class="form-row mb-4">
          <div class="col" *ngIf="!editMode">
            <div><label i18n>Address</label></div>
            <div><span>{{form.get(addressProperty).value}}</span></div>
          </div>
          <div class="col" *ngIf="editMode">
            <app-input-text [form]="form" [property]="addressProperty" i18n-label label="Address">
            </app-input-text>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
