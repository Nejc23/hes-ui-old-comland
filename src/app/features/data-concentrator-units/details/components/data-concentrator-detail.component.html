<!-- reference Details page component -->
<!-- tw--m-5 -> negative margin align hack -->
<div *ngIf="data" [style.width.px]="addWidth()" class="sticky">

  <div [style.width.px]="addWidth()" class="tw-inline-flex tw-justify-between tw-items-center">

    <app-page-title
      [status]="data.statusValue"
      [subtitle]="data.typeValue"
      [title]="data.name"
      class="tw-h-36 tw-mt-10 tw--m-5"
    >
    </app-page-title>

    <div class="tw-mt-10 tw-pr-5">
      <app-dc-operations *ngIf="data" [guid]="concentratorId"
                         [operationType]="componentType.OPERATION"
                         [requestModel]="null"
                         [selectedItemsCount]="1"
                         [showOperations]="true"
                         [type]="data.typeValue" class="tw-mr-2"></app-dc-operations>

      <app-dc-operations *ngIf="data" [guid]="concentratorId"
                         [operationType]="componentType.SECURITY"
                         [requestModel]="null"
                         [selectedItemsCount]="1"
                         [showSecurities]="data.typeValue !== 'AC750'"
                         [type]="data.typeValue"></app-dc-operations>
    </div>

  </div>
</div>

<div *ngIf="data" class="tw-py-10 dcu-tabs">
  <kendo-tabstrip [keepTabContent]="false" class="tw-pt-10">
    <!-- [keepTabContent]="false" set to false due to kendo gauges rerender issue -->
    <kendo-tabstrip-tab [selected]="true"
                        title="{{ 'COMMON.OVERVIEW' | translate }}">
      <ng-template kendoTabContent>

        <div class="tw-py-10">
          <app-slide-out-component (closeButtonClickedEvent)="closeSlideOut()" [title]="'COMMON.EDIT-DETAILS'"
                                   [visible]="openEdit">
            <app-edit-dcu-form (savedDataEvent)="refreshData()"
                               [concentratorId]="data.concentratorId"
                               [credentialsVisible]="credentialsVisible"
                               [form]="editForm">
            </app-edit-dcu-form>
          </app-slide-out-component>

          <!--          <div class="tw-grid tw-grid-cols-2 xl:tw-grid-cols-3 2xl:tw-grid-cols-6 tw-gap-6 tw-py-5">-->

          <!--            <app-mini-card-item [gaugeValue]="99.9" [label]="'Current'" [type]="miniCardItemTypeEnum.GAUGE">-->
          <!--            </app-mini-card-item>-->

          <!--            <app-mini-card-item [gaugeValue]="66.6" [label]="'24h'" [type]="miniCardItemTypeEnum.GAUGE">-->
          <!--            </app-mini-card-item>-->

          <!--            <app-mini-card-item [gaugeValue]="44" [label]="'48h'" [type]="miniCardItemTypeEnum.GAUGE">-->
          <!--            </app-mini-card-item>-->

          <!--            <app-mini-card-item [gaugeValue]="44" [label]="'48h'" [type]="miniCardItemTypeEnum.GAUGE">-->
          <!--            </app-mini-card-item>-->

          <!--            <app-mini-card-item [chartData]="[91, 92, 83, 95, 21, 15, 99, 100, 65, 84, 73, 39, 76]"-->
          <!--                                [label]="'Overall SLA data'"-->
          <!--                                [type]="miniCardItemTypeEnum.CHART"-->
          <!--                                class="tw-col-span-2">-->
          <!--            </app-mini-card-item>-->

          <!--          </div>-->

          <div class="tw-grid tw-grid-cols-1 xl:tw-grid-cols-2 3xl:tw-grid-cols-3 tw-gap-6">

            <app-card-item (buttonClickEvent)="editButtonClicked()" [buttonIconName]="'edit-icon'"
                           [buttonLabel]="'BUTTON.EDIT'" [form]="form"
                           [paginationLimit]="7"
                           [showMoreButton]="true" [title]="'COMMON.DETAILS'">
            </app-card-item>

            <!--            <app-card-item [loadingFailed]="true"-->
            <!--            >-->
            <!--            </app-card-item>-->

            <!--            <app-card-item *ngIf="showMeterStatusWidget"-->
            <!--                           [meterUnitData]="meterStatusData" [meterUnitTotal]="121212" [title]="'COMMON.METER-STATUS'">-->
            <!--            </app-card-item>-->

            <!--            <app-card-item [tags]="tags" [title]="'COMMON.TAGS'">-->
            <!--            </app-card-item>-->

            <!--            <app-card-item [latLang]="[46.2434, 14.4192]"-->
            <!--                           [title]="'Address'">-->
            <!--            </app-card-item>-->

            <!-- todo columnType.ICON -->
            <!--            <app-card-item [buttonLinkUrl]="'alarmsEvents'" [buttonWithLink]="true" [title]="'DCU.LAST-NOTIFICATIONS'">-->
            <!--              <app-data-table [gridColumns]="eventsColumnsConfiguration"-->
            <!--                              [gridData]="alarms"-->
            <!--              ></app-data-table>-->
            <!--            </app-card-item>-->

            <!--            <app-card-item [buttonIconName]="'list-icon'" [buttonLabel]="'BUTTON.GO-TO-JOBS'"-->
            <!--                           [buttonLinkUrl]="'schedulerJobs'"-->
            <!--                           [buttonWithLink]="true"-->
            <!--                           title="JOB.SCHEDULER-JOBS">-->
            <!--              <app-data-table [gridColumns]="scheduledJobsColumnsConfiguration" [gridData]="gridData"-->
            <!--                              [rowActions]="rowActionsConfiguration"></app-data-table>-->
            <!--            </app-card-item>-->

            <!--            <app-card-item *ngIf="showMeterStatusWidget" [loading]="true"-->
            <!--                           [meterUnitData]="meterStatusData" [meterUnitTotal]="121212" [title]="'COMMON.METER-STATUS'">-->
            <!--            </app-card-item>-->

          </div>
        </div>
      </ng-template>
    </kendo-tabstrip-tab>


    <kendo-tabstrip-tab *ngIf="meters.length > 0" title="{{ 'COMMON.METERS' | translate }}">
      <ng-template kendoTabContent>

        <div class="tw-py-10">
          <app-data-table (pageChangedEvent)="loadMoreItems($event)"
                          [excelExport]="true"
                          [fetchData]="true"
                          [gridColumns]="metersColumnsConfiguration"
                          [gridData]="meters"
                          [pageSize]="20"
                          [pageable]="true"
                          [rowHeight]="44"
                          [scrollable]="'virtual'"
                          [skip]="0"
                          [tableHeight]="622"
                          [total]="metersTotal"
                          [withSearch]="true"
          >
          </app-data-table>
        </div>

      </ng-template>
    </kendo-tabstrip-tab>


    <kendo-tabstrip-tab title="{{ 'COMMON.EVENTS' | translate }}">
      <ng-template kendoTabContent>

        <div *ngIf="eventsForm" class="tw-py-10">
          <div class="tw-flex tw-mt-2 tw-w-82 tw-h-14">
            <app-input-text
              #popover="ngbPopover"
              [autoClose]="'outside'"
              [form]="eventsForm"
              [iconName]="'fa-calendar'"
              [isReadOnly]="true"
              [ngbPopover]="popDateTimePicker"
              [property]="'labelText'"
              class="tw-w-full"
              container="body"
              label="Select-date"
              placement="bottom"
              popoverClass="date-range-picker-popover"
            >
            </app-input-text>

            <div (click)="loadRegistersData()" class="tw-pl-2 button-padding-top">
              <div
                class="refresh-button">
                <img [ngClass]="eventsLoading ? 'tw-animate-spin' : ''"
                     src="assets/images/icons/refresh-icon.svg" />
              </div>
            </div>
          </div>

          <div *ngIf="events?.length > 0" class="tw-pt-10">
            <div class="tw-inline-flex tw-justify-between tw-items-center tw-w-full">
              <h4 *ngIf="chartVisible"
                  class="tw-text-darkGray tw-text-base">{{ 'PLC-METER.REGISTER.NUMBER-OF-EVENTS' | translate }}</h4>
            </div>

            <app-registers-column-chart *ngIf="chartVisible" [eventsByTimestamp]="eventsByTimestamp"
                                        [title]="'FORM.TIME' | translate"></app-registers-column-chart>

            <div class="transparent-gray-line tw-flex tw-justify-center">
              <button (click)="hideChart()" class="show-more-rounded-button">
                <ng-container *ngIf="!chartVisible">
                  <img [src]="'assets/images/icons/up-icon.svg'" class="tw-pr-2" />
                  {{ 'COMMON.SHOW-DETAILS' | translate}}
                </ng-container>
                <ng-container *ngIf="chartVisible">
                  <img [src]="'assets/images/icons/down-icon.svg'" class="tw-pr-2" />
                  {{ 'COMMON.HIDE-DETAILS' | translate}}
                </ng-container>
              </button>
            </div>
          </div>

          <app-data-table
            *ngIf="events?.length > 0"
            [excelExport]="true"
            [excelFileName]="data.name + '_events'"
            [filters]="eventsFiltersConfiguration"
            [gridColumns]="eventsColumnsConfiguration"
            [gridData]="events"
            [loading]="eventsLoading"
            [pageSize]="36"
            [pageable]="true"
            [refresh]="false"
            [rowHeight]="44"
            [scrollable]="'virtual'"
            [skip]="0"
            [tableClass]="chartVisible ? 'fixed-height with-chart visible' : 'fixed-height with-chart hidden'"
            [total]="events.length"
            [withSearch]="true"
          >

          </app-data-table>
        </div>

        <app-no-data *ngIf="!events || eventsLoading" [loading]="eventsLoading">
        </app-no-data>

      </ng-template>
    </kendo-tabstrip-tab>

  </kendo-tabstrip>
</div>

<ng-template #popDateTimePicker>
  <app-datetime-range-picker (formClosed)="closePopover()" [form]="eventsForm"
                             [initValues]="true"></app-datetime-range-picker>
</ng-template>
