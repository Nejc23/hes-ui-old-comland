<div class="form-row mt-3">
  <div class="pl-2 pr-2">
      <app-header-title></app-header-title>
    </div>
    <div class="col-1 float-left">
      <i class="fas fa-plus-circle fa-2x text-primary"></i>
    </div>
    <div class="ml-auto pl-2 pr-2 pb-1">
     <app-breadcrumb ></app-breadcrumb>
    </div>
  </div>

<div class="form-row mt-0 bg-white">
  <div class="pl-2 align-bottom pt-3">
    <span class="align-text-bottom">{{totalCount}} items &middot; {{filters}}</span>
  </div>
  <div class="ml-auto mt-2 mb-2 mr-2">
    <app-action-form (refresh)="refreshGrid()" (columnsChange)="setVisibilityGridColumns()"></app-action-form>
  </div>
</div>

<!-- grid -->
<div class=" mt-0 bg-white">
  <dx-data-grid #grid
    id="gridContainer"
    [dataSource]="dataSource"
    [columns]="columns"
    [allowColumnResizing]="true"
    [allowColumnReordering]="true"
    [(selectedRowKeys)]="selectedRows"
    [showRowLines]="true"
    [showBorders]="true"
    [columnAutoWidth]="true"
    [remoteOperations]="true"
    [focusStateEnabled]="true">
  <dxo-selection
    [selectAllMode]="allMode"
    [showCheckBoxesMode]="checkBoxesMode"
    mode="multiple"
  ></dxo-selection>
    <dxo-column-fixing [enabled]="true"></dxo-column-fixing>
    <dxo-paging [pageSize]="20"></dxo-paging>
    <dxo-pager
      alignment="left"
      [showPageSizeSelector]="true"
      [allowedPageSizes]="[20, 50, 100, 150]"
      [showNavigationButtons]="true">
    </dxo-pager>  

    <!-- templates -->
    <div *dxTemplate="let cell of 'cellTemplateName'">
      <div class="text-primary txt-overflow" title="{{ cell.text }}">{{ cell.text }}</div>
    </div>

    <div *dxTemplate="let cell of 'cellTemplateNextReadIcon'">
      <div *ngIf="cell.data.nextRead" class="inline-block pt-0 pb-0 txt-overflow">
        <i class='uil uil-clock text-secondary' title="{{cell.data.nextRead}}"></i>
      </div>
    </div>
   
    <div *dxTemplate="let cell of 'cellTemplateMeters'">
      <div *ngIf="cell.data.metersValue" class="text-left row">
        <div class="col-1 text-left text-primary mr-0">{{cell.data.metersValue}}</div>
        <div *ngIf="cell.data.metersUp" class="col-2 text-success align-right">
          <i class='uil uil-arrow-up text-left'></i><span class="small">{{cell.data.metersPercent}} %</span>
        </div>
        <div *ngIf="!cell.data.metersUp" class="col-2 text-danger align-right">
          <i class='uil uil-arrow-down text-left small'></i><span class="small">{{cell.data.metersPercent}} %</span>
        </div>
      </div>
      <div *ngIf="!cell.data.metersValue" class="text-left text-secondary">
        N/A
      </div>
    </div>

    <div *dxTemplate="let cell of 'cellTemplateReadStatus'" class="text-left row">
      <div>
        <i *ngIf="cell.data.readStatusPercent <= 80" class='fa fa-circle text-danger  text-left ml-2' title="{{cell.data.readStatusPercent}}"></i>
        <i *ngIf="cell.data.readStatusPercent > 80 && cell.data.readStatusPercent <= 90" class='fa fa-circle text-warning  text-left ml-2' title="{{cell.data.readStatusPercent}}"></i>
        <i *ngIf="cell.data.readStatusPercent > 90" class='fa fa-circle text-success text-left ml-2' title="{{cell.data.readStatusPercent}}"></i>         
      </div>
      <div class="col-1 text-primary align-right"><span> {{cell.data.readStatusPercent}} %</span></div>
    </div>

  </dx-data-grid>
</div>

<div class="selected-data">
  <span class="caption">Selected Records:</span>
  <span>
      {{grid.selectedRowKeys ? (grid.instance.getSelectedRowsData() | stringifyData) : 'Nothing has been selected'}}
  </span>
</div>
