<!-- header -->
<div class="form-row mt-3">
  <div class="pl-2 pr-2">
    <app-header-title></app-header-title>
  </div>
  <div class="col-1 float-left">
    <i class="fas fa-plus-circle fa-2x text-primary" [ngbTooltip]="tipContentAdd"></i>
  </div>
  <div class="ml-auto pl-2 pr-2 pb-1">
    <app-breadcrumb></app-breadcrumb>
  </div>
</div>

<!-- row total items, selected filter name --> 
<div class="form-row mt-0 bg-white">
  <div class="pl-2 align-bottom pt-3">
    <span class="align-text-bottom" i18n>{{totalCount}} items &middot; {{filters}}</span>
  </div>
  <div class="ml-auto mt-2 mb-2 mr-2">
    <app-action-form (refresh)="refreshGrid()" (columnsChange)="setVisibilityGridColumns()"></app-action-form>
  </div>
</div>

<!-- grid -->
<div class=" mt-0 bg-white">
  <dx-data-grid #grid
    id="gridContainer"
    [dataSource]="dataSource"
    [columns]="columns"
    [(selectedRowKeys)]="selectedRows"
    [allowColumnResizing]="gridSettings.allowColumnResizing"
    [allowColumnReordering]="gridSettings.allowColumnReordering"
    [showRowLines]="gridSettings.showRowLines"
    [showBorders]="gridSettings.showBorders"
    [columnAutoWidth]="gridSettings.columnAutoWidth"
    [remoteOperations]="gridSettings.remoteOperations"
    [focusStateEnabled]="gridSettings.focusStateEnabled">
    <dxo-selection
      [selectAllMode]="gridSettings.allMode"
      [showCheckBoxesMode]="gridSettings.checkBoxesMode"
      [mode]="gridSettings.selectionMode">
    </dxo-selection>
    <dxo-sorting
      [mode]="gridSettings.sortingMode">
    </dxo-sorting>
    <dxo-column-fixing [enabled]="gridSettings.pinning"></dxo-column-fixing>
    <dxo-paging [pageSize]="gridSettings.pager.defaultPageSize"></dxo-paging>
    <dxo-pager
      [showPageSizeSelector]="gridSettings.pager.showPageSizeSelector"
      [allowedPageSizes]="gridSettings.pager.allowedPageSizes"
      [showNavigationButtons]="gridSettings.pager.showNavigationButtons">
    </dxo-pager>  

    <!-- template for column name -->
    <div *dxTemplate="let cell of 'cellTemplateName'">
      <div class="text-primary txt-overflow" title="{{cell.text}}">{{ cell.text }}</div>
    </div>
    <!-- template for column next read icon -->
    <div *dxTemplate="let cell of 'cellTemplateNextReadIcon'">
      <div *ngIf="cell.data.nextRead" class="inline-block pt-0 pb-0 txt-overflow">
        <i class='uil uil-clock text-secondary' placement="bottom" [ngbTooltip]="setMomentNextPlannedReadTime(cell.data.nextRead)"></i>
      </div>
    </div>
   <!-- template for column meters -->
    <div *dxTemplate="let cell of 'cellTemplateMeters'">
      <div *ngIf="cell.data.metersValue" class="text-left row">
        <div class="col-1 text-left text-primary mr-0">{{cell.data.metersValue}}</div>
        <div *ngIf="cell.data.metersUp" class="col-2 text-success align-right">
          <i class='uil uil-arrow-up text-left'></i><span class="small text-success">{{cell.data.metersPercent}} %</span>
        </div>
        <div *ngIf="!cell.data.metersUp" class="col-2 text-danger align-right">
          <i class='uil uil-arrow-down text-left small text-danger'></i><span class="small text-danger">{{cell.data.metersPercent}} %</span>
        </div>
      </div>
      <div *ngIf="!cell.data.metersValue" class="text-left text-secondary">{{notAvailableText}}</div>
    </div>
    <!-- template for column read status --> 
    <div *dxTemplate="let cell of 'cellTemplateReadStatus'" class="text-left row">
      <div>
        <i *ngIf="cell.data.readStatusPercent <= 80" class='fa fa-circle text-danger  text-left ml-2' title="{{cell.data.readStatusPercent}}"></i>
        <i *ngIf="cell.data.readStatusPercent > 80 && cell.data.readStatusPercent <= 90" class='fa fa-circle text-warning  text-left ml-2' title="{{cell.data.readStatusPercent}}"></i>
        <i *ngIf="cell.data.readStatusPercent > 90" class='fa fa-circle text-success text-left ml-2' title="{{cell.data.readStatusPercent}}"></i>         
      </div>
      <div class="col-1 text-primary align-right"><span> {{cell.data.readStatusPercent}} %</span></div>
    </div>
    <!-- template for column IP -->
    <div *dxTemplate="let cell of 'cellTemplateIp'">     
      <div *ngIf="cell.text" class="txt-overflow" title="{{cell.text}}">{{cell.text}}</div>
      <div *ngIf="!cell.text" class="txt-overflow text-secondary">{{notAvailableText}}</div>
    </div>
    <!-- template for column last communication -->
    <div *dxTemplate="let cell of 'cellTemplateLastCommunication'">     
      <div *ngIf="cell.text" class="txt-overflow" title="{{setMomentLastCommunicationTime(cell.text)}}">{{setMomentLastCommunicationTime(cell.text)}}</div>
      <div *ngIf="!cell.text" class="txt-overflow text-secondary">{{notAvailableText}}</div>
    </div>
    <!-- template for column tags -->
    <div *dxTemplate="let cell of 'cellTemplateTags'" class="text-left row col-md txt-overflow col-12 col-md">     
        <div *ngFor="let item of cell.data.tags; let i = index" class=" bg-secondary mr-1 rcorners3 mt-1">
          <div class="ml-1 mr-1">{{item}}</div>
        </div>
    </div>
  </dx-data-grid>
</div>



<!-- TODO remove only for sample selected items -->
<div class="selected-data">
  <span class="caption">Selected Records:</span>
  <span>
      {{grid.selectedRowKeys ? (grid.instance.getSelectedRowsData() | stringifyData) : 'Nothing has been selected'}}
  </span>
</div>

<ng-template #tipContentAdd><span i18n>Add or import DCU</span></ng-template>